<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UniTN Booking Bot: UniTN Booking Bot Command Cheatsheet</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unitn_logo_100x100.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UniTN Booking Bot
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A Telegram Bot for booking appointments at UniTN</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">UniTN Booking Bot Command Cheatsheet </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ol type="1">
<li><a href="#quick-start">Quick start</a></li>
<li><a href="#database-structure">Database structure</a></li>
<li><a href="#telegram-bot-commands">Telegram Bot commands</a></li>
<li><a href="#code-commands">Code commands</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Quick start</h1>
<p>This file presents a summary of the command usages and the database structure. Other resources you can read include:</p>
<ul>
<li>The repository <code>README.md</code>, concerning the installation and run of the project on a local machine.</li>
<li>The full function documentation, rooted in <code>docs/html/index.html</code>.</li>
<li>Links to the official documentations of all the API used by this project, reported in the file <code>info/api_reference.txt</code>.</li>
<li>The project report, <code>report/</code>, with a full description of the system architecture.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Database structure</h1>
<p>The following picture presents the database structure:</p>
<p><img src="../pictures/database.png" alt="Database Structure" class="inline"/></p>
<ul>
<li><code>users</code>: Collects information about the user.<ul>
<li><code>user_id</code>: integer primary key, identifier of the chat between the user and the Bot.</li>
<li><code>name</code>: 32-char string, full name associate to the user.</li>
<li><code>username</code>: 32-char string, Telegram username (the one starting with @) associate to the user.</li>
</ul>
</li>
<li><code>fairs</code>: Identify groups of events that are related to each other.<ul>
<li><code>fair_id</code>: auto-incremental primary key.</li>
<li><code>name</code>: 32-char string, the fair name in short.</li>
<li><code>description</code>: long string, additional information regarding the fair.</li>
</ul>
</li>
<li><code>events</code>: Collects information about the event. Events are <b>not</b> what will be booked by the user. Users will have to book a time slot that refers to an event instead.<ul>
<li><code>event_id</code>: auto-incremental primary key.</li>
<li><code>fair_id</code>: foreign key referencing <code>fairs</code>, the fair associated to the event.</li>
<li><code>owner_id</code>: foreign key referencing <code>users</code>, the user that published the event.</li>
<li><code>name</code>: 32-char string, the event name in short.</li>
<li><code>description</code>: long string, additional information regarding the event.</li>
</ul>
</li>
<li><code>slots</code>: Each event has multiple time slots associate to it. Each of them can be booked by a single user or "Free", i.e. available for booking.<ul>
<li><code>slot_id</code>: auto-incremental primary key.</li>
<li><code>event_id</code>: foreign key referencing <code>events</code>, the event this slot refers to.</li>
<li><code>user_id</code>: foreign key referencing <code>users</code>, the user that booked the slot. If <code>NULL</code> the slot is said to be "Free".</li>
<li><code>start_time</code>: time string ISO-8601, the starting time of the slot.</li>
<li><code>end_time</code>: time string ISO-8601, the ending time of the slot.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Telegram Bot commands</h1>
<p>This section presents all the commands usable by the Telegram Bot, divided in four categories.</p>
<ul>
<li>Default commands, present in any Telegram Bot.<ul>
<li><code>/start</code>: special command automatically issued at the Bot's start. It logs some generic information about the Bot and its purpose.</li>
<li><code>/help</code>: presents a brief description of all the other commands.</li>
</ul>
</li>
<li>Commands to print records. They print information about the database without modifying it.<ul>
<li><code>/fairs</code>: logs information about a selected fair record.</li>
<li><code>/events</code>: logs information about a selected event record.</li>
<li><code>/whoami</code>: logs information about the user record associated to the current chat.</li>
</ul>
</li>
<li>Commands to update and monitor a slot record. They are supposed to be used by the students, who want to book register themself to an event slot.<ul>
<li><code>/book</code>: updates the <code>user_id</code> field of a selected slot record to be the identifier of the current chat. It also inserts a new user record if the current chat is not in the database yet.</li>
<li><code>/unbook</code>: updates the <code>user_id</code> field of a selected slot record to be <code>NULL</code>.</li>
<li><code>/mybookings</code>: logs information about all the slots whose <code>user_id</code> is the current chat.</li>
</ul>
</li>
<li>Commands to manage event records and the associated slot records. They are supposed to be used by the companies, who want to publish events the students can register to.<ul>
<li><code>/publish</code>: inserts a new event record whose <code>owner_id</code> is the current chat. It also inserts a new user record if the current chat is not in the database yet.</li>
<li><code>/changedes</code>: updates the <code>description</code> field of a selected event.</li>
<li><code>/newslot</code>: inserts a new slot record referring to a selected event. Its <code>user_id</code> will be <code>NULL</code>.</li>
<li><code>/deleteslot</code>: deletes a selected slot record.</li>
<li><code>/deleteevent</code>: deletes a selected event record, as well as all the slot records whose <code>event_id</code> refers to it.</li>
<li><code>/myevents</code>: the user selects an event whose <code>owner_id</code> is the current chat. Then, information about that event record and all the slot record associated to it are logged.</li>
</ul>
</li>
</ul>
<p><b>NOTE</b>: Bot commands do <b>not</b> allow to create fair records, delete fair records or delete user records. Please use the <a href="#code-commands">code commands</a> if you wish to perform any of these operations.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Code commands</h1>
<p>This section presents the functions usable by the <code>edit_dp.py</code> script to directly modify the database via code. All of them require the <code>db</code> parameter, the path to the database file.</p>
<ul>
<li>Functions to inspect the values in the database<ul>
<li><code>print_users_by_id(db)</code>: prints all user records on standard output, ordered by identifier.</li>
<li><code>print_users_by_name(db)</code>: prints all user records on standard output, ordered by name.</li>
<li><code>print_fairs(db,description)</code>: prints all fair records on standard output, ordered by name. The second parameter hides the <code>description</code> field if False.</li>
<li><code>print_events(db,description)</code>: prints all event records on standard output. The second parameter hides the <code>description</code> field if False.</li>
<li><code>print_events_with_fair(db)</code>: prints all event records joined with fairs on standard output.</li>
<li><code>print_events_with_owner(db)</code>: prints all event records joined with users on standard output.</li>
<li><code>print_event_slots(db,event_id)</code>: prints all the slots of a given event on standard output.</li>
</ul>
</li>
<li>Functions to insert new values in the database<ul>
<li><code>insert_user(db,user_id,name,username)</code>: inserts a new user record.</li>
<li><code>insert_fair(db,name,description)</code>: inserts a new fair record.</li>
<li><code>insert_event(db,fair_id,owner_id,name,description)</code>: inserts a new event record.</li>
<li><code>create_slot(db,event_id,start_time,end_time)</code>: inserts a new slot record, <code>user_id</code> is set to <code>NULL</code>.</li>
<li><code>assign_slot(db,slot_id,user_id)</code>: updates the <code>user_id</code> field the selected slot.</li>
</ul>
</li>
<li>Functions to modify the values in the database<ul>
<li><code>update_user(db,user_id,name,username)</code>: updates a user record.</li>
<li><code>update_fair(db,fair_id,name,description)</code>: updates a fair record.</li>
<li><code>update_event(db,event_id,fair_id,owner_id,name,description)</code>: updates an event record</li>
<li><code>update_event_description(db,event_id,description)</code>: updates just the <code>description</code> field of an event record.</li>
<li><code>update_slot(db,slot_idevent_id,user_id,start_time,end_time)</code>: updates a slot record.</li>
</ul>
</li>
<li>Functions to delete values from the database<ul>
<li><code>delete_user(db,user_id)</code>: deletes a user record.</li>
<li><code>delete_fair(db,fair_id)</code>: deletes a fair record.</li>
<li><code>delete_event(db,event_id,delete_slots)</code>: deletes an event record. The second parameter allows to delete also all the slot records associated to it if True.</li>
<li><code>delete_slot(db,slot_id)</code>: deletes a slot record. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
