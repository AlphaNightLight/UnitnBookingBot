<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UniTN Booking Bot: UniTN Booking Bot Readme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="unitn_logo_100x100.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UniTN Booking Bot
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">A Telegram Bot for booking appointments at UniTN</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">UniTN Booking Bot Readme </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md7"></a>
Table of Contents</h1>
<ol type="1">
<li><a href="#quick-start">Quick start</a></li>
<li><a href="#files-in-this-repository">Files in this repository</a></li>
<li><a href="#how-to-install-the-application">How to install the application</a></li>
<li><a href="#how-to-instantiate-a-bot">How to instantiate a bot</a></li>
<li><a href="#how-to-activate-the-bot">How to activate the bot</a></li>
<li><a href="#direct-access-to-the-database">Direct access to the database</a></li>
</ol>
<h1><a class="anchor" id="autotoc_md8"></a>
Quick start</h1>
<p>This README presents the information concerning the installation and run of the project on a local machine. Other resources include:</p>
<ul>
<li>The full project documentation, rooted in <code>docs/index.html</code> and accessible at <a href="https://alphanightlight.github.io/UnitnBookingBot/">https://alphanightlight.github.io/UnitnBookingBot/</a>.</li>
<li>Links to the official documentations of all the API used by this project, reported in the file <code>info/api_reference.txt</code>.</li>
<li>The command cheatsheet, located in <code>info/cheatsheet.md</code>. It also summarizes the database structure.</li>
<li>The project report, <code>report/alex_pegoraro_report.pdf</code>, with a full description of the system architecture.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Files in this repository</h1>
<p>In this project, you will find the following files and folders:</p>
<ul>
<li><code>docs/</code>: output folder for the Doxygen documentation.</li>
<li><code>handlers/</code>: folder containing the python modules defining the handler functions.<ul>
<li><code><a class="el" href="book__commands_8py.html" title="Handlers that manipulate the bookings.">book_commands.py</a></code>: python module defining the handlers for booking manipulation.</li>
<li><code><a class="el" href="event__commands_8py.html" title="Handlers that manipulate the events and associated slots.">event_commands.py</a></code>: python module defining the handlers for event manipulation.</li>
<li><code><a class="el" href="generic__commands_8py.html" title="Handlers for general information.">generic_commands.py</a></code>: python module defining the handlers for general information.</li>
</ul>
</li>
<li><code>info/</code>: folder containing additional information on the project.<ul>
<li><code>api_reference.txt</code>: plain text reporting links to the official documentations of all the libraries used in this project.</li>
<li><code>cheatsheet.md</code>: Markdown file presenting a summary of the command usages and the database structure.</li>
<li><code>mainpage.txt</code>: plain text used to create the home page in the Doxygen documentation.</li>
<li><code>UnitnBookingBot.pptx</code>: Power Point presentation of the project.</li>
</ul>
</li>
<li><code>pictures/</code>: folder containing the pictures used in the report and the documentation.</li>
<li><code>report/</code>: folder containing the LaTex source code for the report.<ul>
<li><code>alex_pegoraro_report.pdf</code>: the project report.</li>
</ul>
</li>
<li><code>utils/</code>: folder containing the python modules for database management.<ul>
<li><code><a class="el" href="db__print_8py.html" title="Functions to print the values from the database.">db_print.py</a></code>: python module defining the functions to print the database on standard output.</li>
<li><code><a class="el" href="db__read_8py.html" title="Functions to retrieve the values from the database.">db_read.py</a></code>: python module defining the functions to read data from the database.</li>
<li><code><a class="el" href="db__write_8py.html" title="Functions to modify the values in the database.">db_write.py</a></code>: python module defining the functions to modify the database.</li>
</ul>
</li>
<li><code>.env</code>: file defining the environment variables of the project.</li>
<li><code>.gitignore</code>: to ignore temporary folders in version controlling.</li>
<li><code>bot_main.py</code>: the main python file of the project, used to run the bot.</li>
<li><code>create_db.py</code>: python script that instantiate the database used by the bot.</li>
<li><code>Doxyfile</code>: configuration file for the Doxygen documentation.</li>
<li><code>edit_db.py</code>: python script that allows direct manipulation of the database.</li>
<li><code>LICENSE</code>: Apache-2.0 license file</li>
<li><code>README.md</code>: this file.</li>
<li><code>requirements.txt</code>: plain text reporting the python requirements to run this project.</li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
How to install the application</h1>
<p>You can clone this repository on your local machine with:</p>
<div class="fragment"><div class="line">git clone git@github.com:AlphaNightLight/UnitnBookingBot.git</div>
</div><!-- fragment --><p>Then, in the root folder of the project create a python virtual environment, activate it and install the project requirements:</p>
<div class="fragment"><div class="line"># Create virtual environment</div>
<div class="line">python -m venv myvenv</div>
<div class="line"> </div>
<div class="line"># Activate it</div>
<div class="line">source myvenv/bin/activate # Linux and MacOS</div>
<div class="line"># venv\Scripts\Activate.ps1 # Windows PowerShell</div>
<div class="line"># venv\Scripts\activate.bat # Windows CMD</div>
<div class="line"> </div>
<div class="line"># Install requirements</div>
<div class="line">pip install -r requirements.txt</div>
</div><!-- fragment --><p>The next step is to create an SQLite database. Inside <code>.env</code> set the variable <code>DB_PATH</code> to the desired database location, then run the <code>create_db.py</code> script:</p>
<div class="fragment"><div class="line">python3 create_db.py</div>
</div><!-- fragment --><p><b>NOTE</b>: in case you already have a database compatible with this Bot, you still need to set <code>DB_PATH</code> to its location, since the main bot script will use this variable to locate the file.</p>
<p>Finally, remember to deactivate the virtual environment with the command <code>deactivate</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
How to instantiate a bot</h1>
<p>To obtain a Telegram Bot you need to contact the "Bot Father", <code>@BotFather</code> username. Issuing the command <code>/newbot</code> it will ask you for a name and username to assign to your bot, and return a <b>Token</b>. Copy-paste this token inside the <code>.env</code> file, as the value of the <code>BOT_TOKEN</code> variable. It's thanks to this token that the project will be able to access your Telegram account.</p>
<p>Trough Bot Father you can also use <code>/setabouttext</code>, <code>/setdescription</code> and <code>/setuserpic</code> to update further information about your bot. See more details on <a href="https://core.telegram.org/bots/features#creating-a-new-bot">the official API</a>.</p>
<p>It is also suggested to set a command list. To do so use the command <code>/mybots</code>, select the bot, then tap on "Edit Commands". After it a command list will be requested as message, send the following:</p>
<div class="fragment"><div class="line">fairs - show all fairs</div>
<div class="line">events - show all events</div>
<div class="line">whoami - check your user metadata</div>
<div class="line">book - book an event</div>
<div class="line">unbook - unbook an event</div>
<div class="line">mybookings - monitor your bookings</div>
<div class="line">publish - publish an event</div>
<div class="line">changedes - change event description</div>
<div class="line">newslot - add a new slot to an event</div>
<div class="line">deleteslot - delete a slot for an event</div>
<div class="line">deleteevent - delete an entire event</div>
<div class="line">myevents - monitor your events</div>
<div class="line">help - show command descriptions</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
How to activate the bot</h1>
<p>To ensure the application works as desired, first open the <code>.env</code> file and check that the environment variables correspond to the desired values:</p>
<ul>
<li><code>DB_PATH</code>: shall store the path to your database file.</li>
<li><code>BOT_TOKEN</code>: shall store the token of a bot you control.</li>
<li><code>DEBUG</code>: if True than the bot will log additional information during the run.</li>
</ul>
<p>To activate the bot it's enough to run the main script:</p>
<div class="fragment"><div class="line">python3 bot_main.py</div>
</div><!-- fragment --><p><b>NOTE</b>: your computer needs an internet access to be able to contact the Telegram API. In case your application is not connected to the internet then the following error will be raised: <code>telegram.error.NetworkError: httpx.ConnectError: [Errno 11001] getaddrinfo failed</code>.</p>
<p>To stop the bot, enter the <code>ctrl+C</code> key on the application terminal.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Direct access to the database</h1>
<p>The file <code>edit_db.py</code> allows you to apply database modifications directly from code, without having to contact the Telegram API and with full access to the records. To do so open the file, uncomment the functions you wish to use, and run it with:</p>
<div class="fragment"><div class="line">python3 edit_db.py</div>
</div><!-- fragment --><p>The most common operation you want to do from code is to create and delete fairs, since it is not possible to do them from the Bot. To create a new fair uncomment <code>insert_fair</code> and set the desired name and description. The path to the database file is automatically retrieved from the environment variable. To delete a fair, use <code>print_fairs</code> to list all fairs. You need to copy the <code>fair_id</code> value of the fair you want to delete, and pass it to the <code>delete_fair</code> function.</p>
<p>See the command cheatsheet <code>info/cheatsheet.md</code> to have more information on the functions you can use, and in case it's not sufficient have a look at their documentation: <a href="https://alphanightlight.github.io/UnitnBookingBot/">https://alphanightlight.github.io/UnitnBookingBot/</a>.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Maintainer</h1>
<p>Alex Pegoraro </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
